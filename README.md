# OddBites - Tripo Gacha 抽卡料理游戏

一个创新的抽卡料理游戏，玩家通过抽取食材卡片，组合生成3D料理模型，并进行售卖获得收益。

## 游戏特色

- 🎴 **策略抽卡**：5个主题卡池，每个卡池有不同的属性倾向
- 🍳 **自由组合**：将抽到的食材卡片组合成独特料理
- 🎨 **3D生成**：集成Tripo AI，根据卡片组合生成3D料理模型
- 📈 **潮流系统**：根据当前潮流获得售价加成
- 💰 **经济循环**：售卖料理获得金币，继续抽卡

## 卡池设计

### 1. 奇趣异域 🌌
- **特点**：奇异度极高，视觉冲击力强
- **适合**：追求创意和稀有视觉效果的玩家
- **代表食材**：外星果实、幽灵蘑菇、荧光蔬菜

### 2. 传统经典 🏠
- **特点**：属性平衡，价格亲民
- **适合**：新手玩家和稳定收益
- **代表食材**：牛肉片、意面、米饭

### 3. 甜点幻想 🧁
- **特点**：甜度爆表，颜值担当
- **适合**：甜品料理和视觉系玩家
- **代表食材**：马卡龙外壳、巧克力酱、果冻球

### 4. 潮流未来 ⚡
- **特点**：科技感十足，属性随机性强
- **适合**：追求前卫和高策略自由度
- **代表食材**：荧光面条、反重力豆、电子香料

### 5. 火焰烈厨 🌶️
- **特点**：辣度爆表，高风险高回报
- **适合**：刺激挑战和高售价追求
- **代表食材**：辣椒碎、火焰肉片、炽热香料

## 技术架构

### 核心系统
- **GameManager**: 游戏核心管理器，处理卡池、抽卡、属性计算
- **CardData**: 卡片数据结构，包含属性和稀有度计算
- **TripoAPI**: 集成Tripo 3D生成API
- **MainGame**: 主游戏界面控制器

### 属性系统
每张卡片包含三个核心属性：
- **辣度 (Spice)**: 0-5，影响料理的刺激程度
- **甜度 (Sweet)**: 0-5，影响料理的甜美程度  
- **奇异度 (Weird)**: 0-10，影响料理的视觉奇特程度

### 潮流加成
根据当前潮流，不同属性组合可获得售价加成：
- **奇异风暴**: 奇异度≥8，加成50%
- **甜蜜时光**: 甜度≥4，加成30%
- **火辣挑战**: 辣度≥4，加成40%
- **未来科技**: 奇异度≥6且辣度≥2，加成30%
- **经典回归**: 三属性都较低，加成20%

## 快速开始

### 环境要求
- Godot 4.4+
- (可选) Tripo API密钥用于真实3D生成

### 运行步骤
1. 用Godot打开项目文件 `project.godot`
2. 点击运行按钮或按F5启动游戏
3. 选择卡池开始抽卡
4. 组合卡片生成料理
5. 查看生成的3D料理模型

### 配置Tripo API
- 目前项目已在 `Scripts/MainGame.gd` 的 `_ready()` 中直接设置了密钥与 Client ID，运行即可调用真实生成。
- 如需改为环境变量方式：
  - Windows PowerShell 运行前设置（临时会话）:
    ```powershell
    $env:TRIPO_API_SECRET="<你的secret>"
    $env:TRIPO_CLIENT_ID="<你的client_id>"
    ```
  - 然后在 `MainGame.gd` 中改回从环境变量读取的代码。

### 生成流程（当前实现）
1. 选择卡池并抽卡；或直接点击“生成料理”，若未选择卡片会自动从已有卡中按价格降序挑选最多5张。
2. 系统将所选卡牌合成为单一道菜的 Prompt（卡通3D风格、合盘呈现）。
3. 调用 Tripo 创建任务并轮询状态（已兼容 `{code, data}` 响应格式，使用一次性 HTTPRequest 避免 ERR_BUSY(44)）。
4. 右侧预览：
   - 立即显示占位几何体（盘子+方块/球体/胶囊，分别映射辣/甜/奇）。
   - 若 Tripo 返回 `generated_image` 预览图，则自动下载并显示。

## 游戏玩法

1. **选择卡池**: 根据策略需求选择不同主题的卡池
2. **抽取卡片**: 消耗金币抽取食材卡片
3. **组合料理**: 选择最多5张卡片组合生成料理（若未选择会自动挑选）
4. **查看属性**: 系统自动计算料理的最终属性
5. **生成模型**: 调用AI生成对应的3D料理模型
6. **售卖获利**: 根据属性和潮流加成获得金币

### Prompt 设计（示例）
系统会生成类似如下的提示词，用于合成“单一道菜”的卡通3D模型：
```
A stylized cartoon 3D dish combining: 辣味青椒, 虹彩坚果, 洋葱丁. Create a single cohesive plated dish, do not separate items. Style: cartoon 3D food, stylized, cohesive single dish, served on a ceramic plate, soft studio lighting, no text, plain background, high quality, spicy, red accents, futuristic elements, playful shapes.
```

## 开发计划

- [x] 核心抽卡系统
- [x] 卡片属性计算
- [x] 基础UI界面（玩家信息、潮流倒计时、商店入口占位）
- [x] 模拟3D生成与占位几何体预览
- [x] 真实 Tripo API 集成（任务创建与轮询、预览图显示）
- [ ] GLTF/GLB 模型加载到 3D 预览
- [ ] 套餐组合系统
- [ ] 潮流任务系统
- [ ] 成就和收集系统
- [ ] 音效和动画
- [ ] 数据持久化

## 常见问题（排错）
- Identifier 未声明：确保 `Scripts/GameManager.gd` 和 `Scripts/TripoAPI.gd` 带有 `class_name`，或在 `MainGame.gd` 顶部使用 `preload()`。
- set_client_id 不存在：项目已做向后兼容，若方法缺失会直接设置字段 `client_id`。
- Invalid assignment translation：Godot 4 使用 `position` 替代 `translation`。
- ERR_BUSY(44)：状态轮询使用一次性 `HTTPRequest`，避免复用同一请求器。

## 贡献

欢迎提交Issue和Pull Request来改进游戏！

## 许可证

MIT License
